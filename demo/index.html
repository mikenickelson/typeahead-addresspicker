<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>typeahead-addresspicker.js</title>
  <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="main">
      <h2>Enter address</h2>
      <div class="address-panel">
        <input id="address1" class="typeahead" type="text" placeholder="Enter an address">   
      </div>

      <div id="extra_fields" style="display: none">
        <input class="form-control" id="city" placeholder="City" size="30"><input class="form-control" id="state" placeholder="State" size="2"><input class="form-control" id="zip" placeholder="Zip" size="9">
        <a class="btn btn-primary" href="#">OK!</a>
      </div> 
    </div>

 <script src="http://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
 <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
 <script src="../dist/typeahead.js"></script>
 <script src="../dist/typeahead-addresspicker.js"></script>
 <script>


  function displayResults(result, div) {
    html = ["Address: " + result.address()]
    html.push("Latitude: " + result.lat())
    html.push("Longitude: " + result.lng())
    html.push("Long names:")
    result.addressTypes().forEach(function(type) {
      html.push("  " + type + ": " + result.nameForType(type))
    })
    html.push("Short names:")
    result.addressTypes().forEach(function(type) {
      html.push("  " + type + ": " + result.nameForType(type, true))
    })
    // console.log(html.join('\n'));
    // console.log(result.placeResult

    console.log(result)



    // if (component.type == "postal_code") {
    //   $('#state').val(component.postal_code())  
    // }

    // console.log(result.placeResult.address_components)
    // $('#city').val(result.city())
  }

  $( function() {
    var addressPicker = new AddressPicker();
    $address = $('#address1');
    $address.typeahead({ autoselect: true}, {
      displayKey: 'description',
      source: addressPicker.ttAdapter(),
    });
    addressPicker.bindDefaultTypeaheadEvent($address)

    $(addressPicker).on('addresspicker:selected', function (event, result) {

      

      var city = result.nameForType('sublocality') || result.nameForType('locality');
      var state = result.nameForType('administrative_area_level_1', true);
      var zip = result.nameForType('postal_code');

      // $('.tt-hint').fadeOut()
      $('#city').val(city);
      $('#state').val(state);
      $('#zip').val(zip);
      
      str = $address.val()
      re = new RegExp(", " + city)
      str = str.replace(re, "")
      re = new RegExp(", " + state)
      str = str.replace(re, "")

      $address.val(str)

      displayResults(result, $('#response1'))
      $('#extra_fields').fadeIn()

      addressPicker.unbindDefaultTypeaheadEvent($address)
      // console.log(addressPicker.lastResult)
    })

  })
  </script>

</body>
</html>
